<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 2a7fdc52-72af-4343-b2bf-8234e3fe6e6a (2025-09-13 12:48Z) -->

# Issue moving album between playlists (2025-09-13 12:48Z)

_**User (2025-09-13 10:19Z)**_

ok, so I just tried to process an album to be moved from one playlist to another (using the 'Yes' button) and got this issue. note that the only change we've done recently is to move the secrets to the backend.  

---

_**Agent (model default, mode Agent)**_

I can see from the console output that there's a 400 Bad Request error when trying to process an album, and it's related to the recent change of moving secrets to the backend. Let me investigate the issue by examining the relevant files.


---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] Investigate the 400 Bad Request error in album processing
- [ ] Check useBackendApi.js for error handling issues
- [ ] Check the Spotify API proxy implementation in functions
- [ ] Fix Vue warning about Error object being passed as string prop

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useBackendApi.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useUserSpotifyApi.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: functions/src/spotify.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: functions/index.js</summary>

</details>
</tool-use>

---

Now I can see the issue! Looking at the error and the code, there are two main problems:

1. **Error handling issue**: In `useBackendApi.js` line 30, when there's a 400 error, it's trying to parse the response as JSON, but if that fails, it creates an Error object. However, in `useUserSpotifyApi.js` line 123, this Error object is being assigned to `error.value` instead of just the error message.

2. **Vue prop type issue**: The `ErrorMessage` component is receiving an Error object instead of a string for its `message` prop.

Let me check the ErrorMessage component to understand the expected prop type:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/components/common/ErrorMessage.vue</summary>

</details>
</tool-use>

---

Perfect! Now I can see the issue clearly. The `ErrorMessage` component expects a `String` prop, but we're passing an `Error` object. Let me fix both issues:


---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Investigate the 400 Bad Request error in album processing
- [x] Check useBackendApi.js for error handling issues
- [ ] Check the Spotify API proxy implementation in functions
- [-] Fix Vue warning about Error object being passed as string prop

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: src/composables/useUserSpotifyApi.js</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -121,5 +121,5 @@
        return await spotifyApiCall(endpointPath, options.method || 'GET', options.body, accessToken);
      } catch (err) {
-       error.value = err;
+       error.value = err.message || err.toString();
        throw err;
      } finally {
```

</details>

</tool-use>

---

Now let me also check if there are any other places in the codebase where Error objects might be passed to components expecting strings. Let me search for ErrorMessage usage:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "ErrorMessage" • 24 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `.\src\views\playlists\PlaylistView.vue` | `import ErrorMessage from '@components/common/ErrorMessage.vue';` | L12 |
| `.\src\views\playlists\PlaylistView.vue` | `<ErrorMessage v-else-if="error" :message="error" />` | L286 |
| `.\src\views\playlists\PlaylistSingle.vue` | `import ErrorMessage from '@components/common/ErrorMessage.vue';` | L14 |
| `.\src\views\playlists\PlaylistSingle.vue` | `<ErrorMessage v-else-if="error" :message="error" />` | L688 |
| `.\src\views\playlists\PlaylistSingle.vue` | `<ErrorMessage v-if="spotifyError" :message="spotifyError" class="mt-4" />` | L753 |
| `.\src\views\auth\AccountView.vue` | `import ErrorMessage from '@components/common/ErrorMessage.vue';` | L8 |
| `.\src\views\auth\AccountView.vue` | `<ErrorMessage v-else-if="userError \|\| authError" :message="userError \|\| authError" />` | L54 |
| `.\src\views\auth\AccountView.vue` | `<ErrorMessage v-if="formError" :message="formError" class="mt-4" />` | L155 |
| `.\src\components\LastFmStats.vue` | `import ErrorMessage from '@/components/common/ErrorMessage.vue';` | L5 |
| `.\src\components\LastFmStats.vue` | `<ErrorMessage v-else-if="hasError" :message="hasError" />` | L143 |
| `.\src\views\playlists\PlaylistManagementView.vue` | `<ErrorMessage v-if="spotifyError" :message="spotifyError.message \|\| spotifyError" class="mt-4" />` | L269 |
| `.\src\views\playlists\PlaylistManagementView.vue` | `import ErrorMessage from '@components/common/ErrorMessage.vue';` | L285 |
| `.\src\views\playlists\EditPlaylistView.vue` | `import ErrorMessage from '@components/common/ErrorMessage.vue';` | L10 |
| `.\src\views\playlists\EditPlaylistView.vue` | `<ErrorMessage v-else-if="error" :message="error" />` | L278 |
| `.\src\views\playlists\AddPlaylistView.vue` | `<ErrorMessage v-if="userError \|\| formError" :message="userError \|\| formError" />` | L273 |
| `.\src\views\playlists\AddPlaylistView.vue` | `import ErrorMessage from '@components/common/ErrorMessage.vue';` | L289 |
| `.\src\views\music\ArtistView.vue` | `import ErrorMessage from '@components/common/ErrorMessage.vue';` | L13 |
| `.\src\views\music\ArtistView.vue` | `<ErrorMessage v-else-if="error" :message="error" />` | L272 |
| `.\src\components\LatestMovements.vue` | `import ErrorMessage from '@/components/common/ErrorMessage.vue';` | L6 |
| `.\src\components\LatestMovements.vue` | `<ErrorMessage v-else-if="error" :message="error" />` | L82 |
| `.\src\views\auth\LoginView.vue` | `import ErrorMessage from '@components/common/ErrorMessage.vue';` | L6 |
| `.\src\views\auth\LoginView.vue` | `<ErrorMessage v-if="authError" :message="authError" />` | L57 |
| `.\src\composables\useAuth.js` | `error.value = getAuthErrorMessage(err.code);` | L20 |
| `.\src\composables\useAuth.js` | `const getAuthErrorMessage = (errorCode) => \{` | L43 |


</details>
</tool-use>

---

I can see that most components are correctly passing error messages as strings, but let me check the specific file mentioned in the error - `PlaylistSingle.vue` - to see how the error is being handled there:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/views/playlists/PlaylistSingle.vue</summary>

</details>
</tool-use>

---

Good! I can see that in `PlaylistSingle.vue` line 646, the error is being handled correctly by extracting `err.message`. However, let me check where the `spotifyError` is being used in the template:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/views/playlists/PlaylistSingle.vue</summary>

</details>
</tool-use>

---

The template looks correct. Let me check if there are any other places where error objects might be passed. Let me also check the `useBackendApi.js` to see if there are any other error handling issues:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useBackendApi.js</summary>

</details>
</tool-use>

---

I can see that `useBackendApi.js` is correctly handling the error by setting `error.value = err.message` on line 35. The issue was specifically in `useUserSpotifyApi.js` where it was setting `error.value = err` instead of `err.message`.

Now let me check if there are any other similar issues in the codebase. Let me also check the specific error that's happening - the 400 Bad Request. Let me look at the Spotify API proxy to see if there might be an issue with the request format:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: functions/src/spotify.js</summary>

</details>
</tool-use>

---

The Spotify API proxy looks correct. The issue might be with the request data format. Looking at the console output, I can see that the request body for removal is being sent correctly with the track URIs. Let me check if there's an issue with how the data is being passed to the proxy.

Looking at the console output again, I can see that the request body shows:
```json
{
  "tracks": [
    {"uri": "spotify:track:2UfmsoA7vv2K450R5aWgpd"},
    {"uri": "spotify:track:1inFDe0eyUjugdg3dunqQ1"},
    // ... more tracks
  ]
}
```

This looks correct according to the Spotify API documentation. However, let me check if there might be an issue with the endpoint path or the way the data is being passed to the proxy.

Let me check the `removeTracksFromPlaylist` function more carefully:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useUserSpotifyApi.js</summary>

</details>
</tool-use>

---

I see a potential issue! In line 307, the function is calling `JSON.stringify(requestBody)` but then in `makeUserRequest`, it's likely being stringified again. Let me check the `makeUserRequest` function:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useUserSpotifyApi.js</summary>

</details>
</tool-use>

---

Yes! That's the issue. In `removeTracksFromPlaylist`, the `requestBody` is being JSON.stringify'd on line 307, but then in `makeUserRequest` on line 121, it's passing `options.body` (which is already a string) to `spotifyApiCall`. Then in the backend proxy, it's being JSON.stringify'd again on line 172.

This means the data is being double-encoded, which would cause a 400 Bad Request error.

Let me fix this:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: src/composables/useUserSpotifyApi.js</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -305,5 +305,5 @@
      return makeUserRequest(&#96;https://api.spotify.com/v1/playlists/${playlistId}/tracks&#96;, {
        method: 'DELETE',
-       body: JSON.stringify(requestBody)
+       body: requestBody
      });
    };
```

</details>

</tool-use>

---

Now let me check if there are other similar issues in the codebase where data is being double-encoded:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "JSON\.stringify.*body" • 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `.\src\composables\useBackendApi.js` | `body: JSON.stringify(options.body \|\| \{}),` | L25 |


</details>
</tool-use>

---

Let me also check for other places where `makeUserRequest` is called with a body that might be double-encoded:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "makeUserRequest.*body.*JSON\.stringify" • 0 matches</summary>

Output mode: content


_No matches found_

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "body: JSON\.stringify" • 4 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `.\src\composables\useUserSpotifyApi.js` | `body: JSON.stringify(playlistData)` | L150 |
| `.\src\composables\useUserSpotifyApi.js` | `body: JSON.stringify(\{` | L160 |
| `.\src\composables\useUserSpotifyApi.js` | `body: JSON.stringify(updates)` | L200 |
| `.\src\composables\useBackendApi.js` | `body: JSON.stringify(options.body \|\| \{}),` | L25 |


</details>
</tool-use>

---

I found more instances! Let me check and fix these:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useUserSpotifyApi.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useUserSpotifyApi.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useUserSpotifyApi.js</summary>

</details>
</tool-use>

---

I need to fix all these instances where JSON.stringify is being used before passing to makeUserRequest:


---

<tool-use data-tool-type="write" data-tool-name="MultiEdit">

<details><summary>Tool use: **MultiEdit** • Edit file: src/composables/useUserSpotifyApi.js</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -148,5 +148,5 @@
      return makeUserRequest(&#96;https://api.spotify.com/v1/users/${profile.id}/playlists&#96;, {
        method: 'POST',
-       body: JSON.stringify(playlistData)
+       body: playlistData
      });
    };
```

**Chunk 2**
Lines added: 2, lines removed: 2

```diff
@@ -158,7 +158,7 @@
      return makeUserRequest(&#96;https://api.spotify.com/v1/playlists/${playlistId}/tracks&#96;, {
        method: 'POST',
-       body: JSON.stringify({
+       body: {
          uris: trackUris
-       })
+       }
      });
    };
```

**Chunk 3**
Lines added: 1, lines removed: 1

```diff
@@ -198,5 +198,5 @@
      return makeUserRequest(&#96;https://api.spotify.com/v1/playlists/${playlistId}&#96;, {
        method: 'PUT',
-       body: JSON.stringify(updates)
+       body: updates
      });
    };
```

</details>

</tool-use>

---

Now let me update the TODO list and check for any linting errors:


---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Investigate the 400 Bad Request error in album processing
- [x] Check useBackendApi.js for error handling issues
- [x] Check the Spotify API proxy implementation in functions
- [x] Fix Vue warning about Error object being passed as string prop
- [x] Fix double JSON encoding issue in API calls

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `src/composables/useUserSpotifyApi.js`

Lint results


**No lint errors found**
</details>
</tool-use>

---

Perfect! Now let me also check if there are any other similar issues in the codebase. Let me search for any other places where data might be double-encoded:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "spotifyApiCall.*JSON\.stringify" • 0 matches</summary>

Output mode: content


_No matches found_

</details>
</tool-use>

---

Great! Now let me also check if there are any other error handling issues in the codebase. Let me look for other places where Error objects might be passed to components:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "error\.value = err[^.]" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `.\src\composables\useSpotifyApi.js` | `error.value = err;` | L50 |
| `.\src\composables\useSpotifyApi.js` | `error.value = err;` | L80 |


</details>
</tool-use>

---

I found more instances! Let me check and fix these in `useSpotifyApi.js`:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useSpotifyApi.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useSpotifyApi.js</summary>

</details>
</tool-use>

---

Let me fix these as well:


---

<tool-use data-tool-type="write" data-tool-name="MultiEdit">

<details><summary>Tool use: **MultiEdit** • Edit file: src/composables/useSpotifyApi.js</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -48,5 +48,5 @@
        return token.value;
      } catch (err) {
-       error.value = err;
+       error.value = err.message || err.toString();
        throw err;
      } finally {
```

**Chunk 2**
Lines added: 1, lines removed: 1

```diff
@@ -78,5 +78,5 @@
        return await response.json();
      } catch (err) {
-       error.value = err;
+       error.value = err.message || err.toString();
        throw err;
      } finally {
```

</details>

</tool-use>

---

Let me check for any other similar issues:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "error\.value = [^e]" • 57 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `.\src\composables\useSpotifyApi.js` | `error.value = null;` | L26 |
| `.\src\composables\useSpotifyApi.js` | `error.value = null;` | L63 |
| `.\src\composables\useUserSpotifyApi.js` | `error.value = null;` | L85 |
| `.\src\components\AlbumItem.vue` | `error.value = null;` | L98 |
| `.\src\composables\useAlbumsData.js` | `error.value = null;` | L49 |
| `.\src\composables\useAlbumsData.js` | `error.value = 'Failed to fetch album data';` | L96 |
| `.\src\composables\useAlbumsData.js` | `error.value = null;` | L155 |
| `.\src\composables\useAlbumsData.js` | `error.value = 'Failed to search albums';` | L176 |
| `.\src\composables\useAlbumsData.js` | `error.value = null;` | L195 |
| `.\src\composables\useAlbumsData.js` | `error.value = 'Failed to search albums';` | L242 |
| `.\src\composables\useAlbumsData.js` | `error.value = null;` | L258 |
| `.\src\composables\useAlbumsData.js` | `error.value = 'Failed to search albums';` | L280 |
| `.\src\composables\useAlbumsData.js` | `error.value = null;` | L296 |
| `.\src\composables\useAlbumsData.js` | `error.value = 'Failed to search albums';` | L315 |
| `.\src\composables\useAlbumsData.js` | `error.value = null;` | L335 |
| `.\src\composables\useAlbumsData.js` | `error.value = null;` | L407 |
| `.\src\composables\useAlbumsData.js` | `error.value = 'Failed to fetch album details';` | L425 |
| `.\src\composables\useAlbumsData.js` | `error.value = null;` | L497 |
| `.\src\views\playlists\PlaylistView.vue` | `error.value = null;` | L130 |
| `.\src\views\playlists\PlaylistView.vue` | `error.value = "Browser storage is full. Please go to Account > Cache Management to clear some cache data, then try again.";` | L201 |
| `.\src\views\playlists\PlaylistView.vue` | `error.value = "Failed to load playlists. Please try again.";` | L203 |
| `.\src\views\playlists\PlaylistView.vue` | `error.value = "Browser storage is full. Please go to Account > Cache Management to clear some cache data, then try again.";` | L235 |
| `.\src\views\playlists\PlaylistView.vue` | `error.value = "An unexpected error occurred. Please try again.";` | L237 |
| `.\src\views\playlists\PlaylistSingle.vue` | `error.value = null;` | L358 |
| `.\src\views\playlists\PlaylistSingle.vue` | `error.value = null;` | L447 |
| `.\src\views\playlists\PlaylistSingle.vue` | `error.value = null;` | L465 |
| `.\src\views\playlists\PlaylistSingle.vue` | `error.value = "Browser storage is full. Please go to Account > Cache Management to clear some cache data, then try again.";` | L481 |
| `.\src\composables\useBackendApi.js` | `error.value = null;` | L16 |
| `.\src\views\music\AlbumView.vue` | `error.value = null;` | L118 |
| `.\src\views\music\AlbumView.vue` | `error.value = null;` | L141 |
| `.\src\composables\useLastFmApi.js` | `error.value = null;` | L17 |
| `.\src\views\playlists\EditPlaylistView.vue` | `error.value = null;` | L88 |
| `.\src\views\playlists\EditPlaylistView.vue` | `error.value = null;` | L203 |
| `.\src\composables\usePlaylistData.js` | `error.value = null;` | L97 |
| `.\src\composables\usePlaylistData.js` | `error.value = 'Failed to fetch playlists';` | L145 |
| `.\src\views\music\SearchView.vue` | `error.value = null;` | L89 |
| `.\src\views\music\SearchView.vue` | `error.value = 'Failed to search. Please try again.';` | L119 |
| `.\src\views\music\ArtistView.vue` | `error.value = null;` | L200 |
| `.\src\composables\useLatestMovements.js` | `error.value = null;` | L26 |
| `.\src\composables\useLatestMovements.js` | `error.value = 'Failed to fetch latest movements';` | L121 |
| `.\src\composables\useUserData.js` | `error.value = null;` | L15 |
| `.\src\composables\useUserData.js` | `error.value = "Failed to fetch user data.";` | L28 |
| `.\src\composables\useAlbumMappings.js` | `error.value = null;` | L17 |
| `.\src\composables\useAlbumMappings.js` | `error.value = 'Failed to check if album is an alternate ID';` | L26 |
| `.\src\composables\useAlbumMappings.js` | `error.value = null;` | L41 |
| `.\src\composables\useAlbumMappings.js` | `error.value = 'Failed to fetch album mapping';` | L60 |
| `.\src\composables\useAlbumMappings.js` | `error.value = null;` | L75 |
| `.\src\composables\useAlbumMappings.js` | `error.value = 'Failed to fetch alternate IDs';` | L85 |
| `.\src\composables\useAlbumMappings.js` | `error.value = null;` | L101 |
| `.\src\composables\useAlbumMappings.js` | `error.value = 'Failed to create album mapping';` | L118 |
| `.\src\composables\useAuth.js` | `error.value = null;` | L13 |
| `.\src\composables\useAuth.js` | `error.value = getAuthErrorMessage(err.code);` | L20 |
| `.\src\composables\useAuth.js` | `error.value = null;` | L29 |
| `.\src\composables\useAuth.js` | `error.value = 'Failed to sign out. Please try again.';` | L36 |
| `.\src\composables\useForm.js` | `error.value = null;` | L13 |
| `.\src\composables\useForm.js` | `error.value = null;` | L19 |
| `.\src\composables\useCache.js` | `error.value = null;` | L11 |


</details>
</tool-use>

---

Good! Most of these are setting error.value to null or string messages, which is correct. Let me check for any linting errors in the files I've modified:


---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 2 files</summary>
      
Lint paths:

- `src/composables/useSpotifyApi.js`
- `src/composables/useUserSpotifyApi.js`

Lint results


**No lint errors found**
</details>
</tool-use>

---

Perfect! Now let me create a summary of the issues I found and fixed:

## Summary

I've identified and fixed the issues causing the 400 Bad Request error and Vue warning when processing albums:

### Issues Found:

1. **Double JSON Encoding**: The main cause of the 400 error was that request bodies were being JSON.stringify'd twice:
   - First in the individual functions (like `removeTracksFromPlaylist`, `createPlaylist`, etc.)
   - Then again in the backend proxy (`useBackendApi.js` line 25)
   - This resulted in malformed JSON being sent to the Spotify API

2. **Error Object Type Mismatch**: Error objects were being passed directly to Vue components expecting string props, causing the Vue warning.

### Fixes Applied:

1. **Fixed Double Encoding** in `src/composables/useUserSpotifyApi.js`:
   - Removed `JSON.stringify()` calls from `removeTracksFromPlaylist`, `createPlaylist`, `addTracksToPlaylist`, and `updatePlaylist` functions
   - The backend proxy already handles JSON stringification

2. **Fixed Error Handling** in both `src/composables/useUserSpotifyApi.js` and `src/composables/useSpotifyApi.js`:
   - Changed `error.value = err` to `error.value = err.message || err.toString()`
   - This ensures ErrorMessage components receive strings instead of Error objects

### Files Modified:
- `src/composables/useUserSpotifyApi.js` - Fixed double encoding and error handling
- `src/composables/useSpotifyApi.js` - Fixed error handling

The album processing should now work correctly without the 400 error or Vue warnings. The request bodies will be properly formatted and error messages will display correctly in the UI.

---

