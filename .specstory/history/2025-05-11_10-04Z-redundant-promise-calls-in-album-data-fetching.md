<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session a2baead9-77f7-4a69-b514-3f47f1d3cae5 (2025-05-11 10:04Z) -->

# Redundant Promise Calls in Album Data Fetching (2025-05-11 10:04Z)

_**User (2025-05-11 07:24Z)**_

this is twice. is that necessary? await Promise.all(albumData.value.map(async (album) => {
      album.ratingData = await getAlbumRatingData(album.id);
    }));

---

_**Agent (mode Agent)**_

No, it is not necessary to call this block twice. In your `fetchArtistData` function, you have:

```js
// First occurrence (when using cache)
await Promise.all(albumData.value.map(async (album) => {
  album.ratingData = await getAlbumRatingData(album.id);
}));
```

and then again after fetching fresh data:

```js
// Second occurrence (after fetching from API)
await Promise.all(albumData.value.map(async (album) => {
  album.ratingData = await getAlbumRatingData(album.id);
}));
```

**Why is it there twice?**
- The first is inside the cache hit block, to ensure that even when using cached album data, you fetch fresh rating data for each album.
- The second is after fetching new album data from the API, to attach rating data to each album.

**Is it necessary?**
- You only need to call it once per data load. If you are using cached data, call it after setting `albumData.value` from the cache. If you are fetching fresh data, call it after setting `albumData.value` from the API.  
- The two calls are in different branches (`if (cachedData)` and the `else`), so only one will run per function call.  
- If you see both running for a single load, that would be a bug, but as written, only one should run per load.

**Summary:**  
It is not redundant in this context, because only one will execute depending on whether you use cached data or fetch new data. If you want to avoid code duplication, you could extract the logic into a helper function, but functionally, only one call happens per data load.

---

