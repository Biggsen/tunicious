<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 4242f753-d214-4cf9-a845-d8d75d9b0df6 (2025-11-02 07:39Z) -->

# Storing alternate IDs in album documents (2025-11-02 07:39Z)

_**User (2025-11-02 07:09Z)**_

we have albums collection and then we have albumMappings collection. The primaryId matches the albums document id. Any reason why the alternate Id couldn;t be stroed in the album document?

---

_**Agent (model default, mode Ask)**_



---


Reviewing the current structure to explain why alternate IDs aren't stored in the album document.


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: .cursor/rules/data-structures.mdc</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How are albumMappings used to resolve alternate IDs to primary IDs?" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `src/composables/useAlbumMappings.js` | L132 |
| `src/composables/useAlbumMappings.js` | L1-132 |
| `.cursor/rules/data-structures.mdc` | L146-199 |
| `src/views/music/ArtistView.vue` | L51-103 |
| `src/views/playlists/PlaylistSingle.vue` | L1082-1132 |
| `src/views/playlists/PlaylistSingle.vue` | L1047-1088 |
| `src/views/music/AlbumView.vue` | L161-218 |
| `src/views/music/AlbumView.vue` | L247-310 |
| `src/composables/useAlbumsData.js` | L25-576 |
| `firestore.rules` | L44 |
| `src/views/music/AlbumView.vue` | L47 |
| `src/components/AlbumMappingManager.vue` | L57 |
| `src/views/music/ArtistView.vue` | L54 |
| `src/components/AlbumItem.vue` | L205-241 |
| `src/views/music/AlbumView.vue` | L305-357 |

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "albumMappings|albumMapping" • 2 matches</summary>

Output mode: files_with_matches


| File |
|------|
| `.\src\composables\useAlbumMappings.js` |
| `.\firestore.rules` |


</details>
</tool-use>

---



---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useAlbumMappings.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "Where is getPrimaryId called to resolve alternate album IDs before fetching album data?" • **14** results</summary>
            
| File | Lines |
|------|-------|
| `src/composables/useAlbumMappings.js` | L132 |
| `src/views/music/AlbumView.vue` | L247-310 |
| `src/composables/useAlbumsData.js` | L25-576 |
| `src/composables/useAlbumMappings.js` | L1-132 |
| `src/views/music/ArtistView.vue` | L51-103 |
| `src/views/playlists/PlaylistSingle.vue` | L1082-1132 |
| `src/views/music/AlbumView.vue` | L47 |
| `src/views/playlists/PlaylistSingle.vue` | L1047-1088 |
| `src/views/music/AlbumView.vue` | L42-114 |
| `src/views/music/AlbumView.vue` | L161-218 |
| `src/views/playlists/PlaylistSingle.vue` | L490-536 |
| `src/views/playlists/PlaylistSingle.vue` | L460-496 |
| `src/views/music/ArtistView.vue` | L101-148 |
| `src/views/music/ArtistView.vue` | L54 |

</details>
</tool-use>

---



---

Storing alternate IDs in the album document doesn't match the lookup pattern.

**The query direction is reversed**: The system needs to look up by alternate ID → find primary ID. In `useAlbumsData.js`, you see:

```40:60:src/composables/useAlbumsData.js
  const fetchUserAlbumData = async (albumId) => {
    // ...
    // If not found, check if it's an alternate ID
    if (!albumDoc.exists()) {
      const primaryId = await getPrimaryId(albumId);
      if (primaryId) {
        albumDoc = await getDoc(doc(db, 'albums', primaryId));
      }
    }
```

**Reasons a separate collection is better:**
1. Lookup pattern: Start with an alternate ID (from Spotify) and find the primary document. With alternate IDs in the album doc, you'd query by a field instead of the document ID.
2. Multiple alternates: `getAlternateIds()` shows one primary can have many alternates. With an array in the album doc, you'd need to query across arrays to find which album contains a given alternate ID.
3. Index efficiency: The mapping collection indexes `alternateId` for direct lookups. Querying album documents by an alternateIds field would require a different index.
4. Discovery workflow: When a new alternate ID appears, you add a mapping document without modifying the album document.

In short, the lookup is alternate → primary, not primary → alternate, which favors the separate collection design.

---

