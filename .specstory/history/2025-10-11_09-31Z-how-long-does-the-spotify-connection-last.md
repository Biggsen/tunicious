<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 22fc2757-cd20-4364-b768-04a16df96b02 (2025-10-11 09:31Z) -->

# How long does the Spotify connection last? (2025-10-11 09:31Z)

_**User (2025-10-11 09:30Z)**_

is there a setting on how long the spotify connection lasts?

---

_**Agent (model default, mode Ask)**_

<think><details><summary>Thought Process</summary>
The user is asking about settings for how long the Spotify connection lasts. This is likely related to OAuth token expiration and refresh token handling. Let me search for how Spotify authentication is handled in this codebase.

I should look for:
1. Spotify authentication code
2. Token storage and management
3. Any expiration settings or refresh logic

Let me start by searching for Spotify auth related code.</details></think>

---

I'll help you find information about Spotify connection duration settings in your codebase.

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How is Spotify token expiration handled?" • **14** results</summary>
            
| File | Lines |
|------|-------|
| `src/utils/auth.js` | L60 |
| `src/composables/useSpotifyApi.js` | L231 |
| `src/composables/useUserSpotifyApi.js` | L4-447 |
| `functions/src/spotify.js` | L81-142 |
| `src/composables/useUserSpotifyApi.js` | L447 |
| `src/components/SpotifyDiagnostic.vue` | L60-106 |
| `src/views/auth/SpotifyCallbackView.vue` | L74 |
| `functions/src/spotify.js` | L14-138 |
| `functions/src/spotify.js` | L77 |
| `src/composables/useBackendApi.js` | L85 |
| `tasks/security-remediation-spec.md` | L63 |
| `functions/src/spotify.js` | L82-187 |
| `src/composables/useSpotifyApi.js` | L1-231 |
| `src/components/SpotifyDiagnostic.vue` | L98-137 |

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "expires_in|expiresAt|token.*expir" • 31 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `.\src\components\SpotifyDiagnostic.vue` | `tokenExpired: false,` | L17 |
| `.\src\components\SpotifyDiagnostic.vue` | `tokenExpired: false,` | L32 |
| `.\src\components\SpotifyDiagnostic.vue` | `// Check 5: Token expiration` | L68 |
| `.\src\components\SpotifyDiagnostic.vue` | `const expiresAt = userData.spotifyTokens.expiresAt;` | L70 |
| `.\src\components\SpotifyDiagnostic.vue` | `if (expiresAt && expiresAt > now) \{` | L71 |
| `.\src\components\SpotifyDiagnostic.vue` | `console.log('✅ Token is valid, expires at:', new Date(expiresAt));` | L73 |
| `.\src\components\SpotifyDiagnostic.vue` | `diagnosticResults.value.tokenExpired = true;` | L75 |
| `.\src\components\SpotifyDiagnostic.vue` | `diagnosticResults.value.errors.push(`Token expired at: $\{new Date(expiresAt)\}`);` | L76 |
| `.\src\components\SpotifyDiagnostic.vue` | `console.log('❌ Token expired at:', new Date(expiresAt));` | L77 |
| `.\src\composables\useUserSpotifyApi.js` | `// Check if token is expired` | L31 |
| `.\src\composables\useUserSpotifyApi.js` | `if (userData.spotifyTokens.expiresAt < Date.now()) \{` | L32 |
| `.\src\composables\useUserSpotifyApi.js` | `throw new Error('Spotify token expired - please reconnect');` | L33 |
| `.\src\composables\useUserSpotifyApi.js` | `// Get tokens directly from Firestore without expiration check` | L48 |
| `.\src\composables\useUserSpotifyApi.js` | `expiresAt: Date.now() + (result.expiresIn * 1000)` | L67 |
| `.\src\composables\useUserSpotifyApi.js` | `console.log('Using existing token, expires at:', new Date(tokens.expiresAt));` | L91 |
| `.\src\composables\useUserSpotifyApi.js` | `// Try to refresh token if expired` | L94 |
| `.\src\composables\useSpotifyApi.js` | `const tokenExpiry = ref(null);` | L8 |
| `.\src\composables\useSpotifyApi.js` | `if (!token.value \|\| (tokenExpiry.value && Date.now() >= tokenExpiry.value)) \{` | L14 |
| `.\src\composables\useSpotifyApi.js` | `// Set token expiry to 55 minutes (token lasts 1 hour)` | L45 |
| `.\src\composables\useSpotifyApi.js` | `tokenExpiry.value = Date.now() + (55 * 60 * 1000);` | L46 |
| `.\src\views\auth\SpotifyCallbackView.vue` | `expiresAt: Date.now() + (tokens.expiresIn * 1000)` | L35 |
| `.\functions\src\spotify.js` | `expiresIn: tokenData.expires_in,` | L71 |
| `.\functions\src\spotify.js` | `expiresIn: tokenData.expires_in,` | L132 |
| `.\tasks\security-remediation-spec.md` | `Response: \{ accessToken: string, refreshToken: string, expiresIn: number \}` | L36 |
| `.\tasks\security-remediation-spec.md` | `Response: \{ accessToken: string, expiresIn: number \}` | L43 |
| `.\src\utils\auth.js` | `const tokenExpiryDate = localStorage.getItem("tokenExpiryDate");` | L17 |
| `.\src\utils\auth.js` | `if (currentToken && tokenExpiryDate && !isTokenExpired(tokenExpiryDate)) \{` | L19 |
| `.\src\utils\auth.js` | `// If no token or expired, get a new one` | L23 |
| `.\src\utils\auth.js` | `localStorage.setItem("tokenExpiryDate", expiryDate.toString());` | L27 |
| `.\src\utils\auth.js` | `localStorage.removeItem("tokenExpiryDate");` | L41 |
| `.\src\utils\auth.js` | `function isTokenExpired(expiryDate) \{` | L44 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Now let me look at the Spotify callback view to see how the tokens are stored with expiration:</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/views/auth/SpotifyCallbackView.vue</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useUserSpotifyApi.js</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Now I have a good understanding. Let me look at what Spotify returns as the default expiration time. Based on the code, I can see:

1. In `src/composables/useSpotifyApi.js` (line 46): For client credentials flow, the token expiry is set to 55 minutes (token lasts 1 hour)
2. In `src/utils/auth.js` (line 25): There's also a 1 hour expiration (3600000 milliseconds)
3. In `src/views/auth/SpotifyCallbackView.vue` (line 35) and `src/composables/useUserSpotifyApi.js` (line 67): The user token expiration uses `tokens.expiresIn * 1000` which comes from the Spotify API response

The Spotify API returns `expires_in` in seconds (typically 3600 seconds = 1 hour), and the code converts it to milliseconds and adds it to the current timestamp.

So the answer is: Spotify access tokens expire after 1 hour by default (this is set by Spotify, not configurable), but the app automatically refreshes them using the refresh token. The refresh token doesn't expire unless the user revokes access.</details></think>

---

Based on the code, here's how Spotify connection duration works in your app:

## Token Expiration

**Access Token:** Expires after **1 hour** (3600 seconds)
- This is set by Spotify's OAuth API and **cannot be changed**
- The `expiresIn` value comes from Spotify's response when authenticating

**Refresh Token:** Does not expire
- Stored in Firestore at `users/{uid}/spotifyTokens.refreshToken`
- Used to automatically get new access tokens
- Only becomes invalid if user manually revokes access in their Spotify account

## Where This Is Set

The expiration is handled in multiple places:

**User OAuth tokens** (lines 35-36 in `SpotifyCallbackView.vue`):
```javascript
expiresAt: Date.now() + (tokens.expiresIn * 1000)
```

**Token refresh** (line 67 in `useUserSpotifyApi.js`):
```javascript
expiresAt: Date.now() + (result.expiresIn * 1000)
```

The app automatically refreshes expired tokens before making API calls, so users stay connected indefinitely unless they:
1. Manually disconnect from the Account page
2. Revoke access from their Spotify account settings

There's no configurable setting to change this duration - it's controlled by Spotify's OAuth implementation.

---

_**User (2025-10-11 09:30Z)**_

viewing or modifying playlists from an authenticated user expires then in an hour? this is clearly not acceptable in terms of a functioning app.

---

_**Agent (model default, mode Ask)**_

<think><details><summary>Thought Process</summary>
The user is concerned that the Spotify connection expires after an hour. Let me check the code more carefully - I saw that there's automatic token refresh logic. Let me verify if the app is actually handling token refresh properly for user operations.

Looking at the code I already have:

1. In `useUserSpotifyApi.js`, the `makeUserRequest` function (lines 82-128) has logic to:
   - Try to get tokens from Firestore
   - If token is expired, it catches the error and calls `refreshUserToken()` (line 98)
   - The `refreshUserToken()` function uses the refresh token to get a new access token

2. The refresh token doesn't expire, so the app should be able to automatically refresh the access token when needed.

However, looking at line 32-34 in `useUserSpotifyApi.js`:
```javascript
// Check if token is expired
if (userData.spotifyTokens.expiresAt < Date.now()) {
  throw new Error('Spotify token expired - please reconnect');
}
```

This throws an error which is then caught in the `makeUserRequest` function, which then tries to refresh. So the flow should work.

But I need to verify this is actually working correctly. Let me check if there might be an issue with how this is implemented.

Actually, looking at the code flow more carefully:
1. `getUserTokens()` checks if token is expired and throws error (line 32-34)
2. `makeUserRequest()` catches this error and checks if it contains "expired" or "reconnect" (line 95)
3. If so, it calls `refreshUserToken()` (line 98)
4. `refreshUserToken()` gets a new access token and updates Firestore (lines 60-72)

So the automatic refresh should be working. But the user is saying it's "clearly not acceptable", which suggests they might be experiencing an issue or don't understand that it auto-refreshes.
 
The authentication mechanism seamlessly handles token expiration behind the scenes. Users won't experience interruptions because the system automatically obtains a fresh access token using the persistent refresh token, ensuring continuous Spotify integration without manual intervention.</details></think>

---

Actually, the app **does** automatically refresh tokens - users should NOT expire after an hour. Let me show you the auto-refresh logic:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useUserSpotifyApi.js</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
The automatic refresh logic is already there in the code. The user seems concerned that connections expire, but looking at the code:

1. Every API request checks if the token is expired (line 32 in getUserTokens)
2. If expired, it throws an error that's caught by makeUserRequest (line 92-117)
3. The error handler specifically checks for "expired" or "reconnect" messages (line 95)
4. If found, it calls refreshUserToken() which gets a new access token using the refresh token (line 98)
5. The refresh token itself never expires

So theoretically, users should stay connected indefinitely. However, the user is reporting this as "clearly not acceptable", which makes me think either:
1. They don't understand that auto-refresh is happening
2. The auto-refresh is not working properly in some scenarios
3. There's a UI/UX issue where users think they're disconnected when they're not

Let me check if there might be any gaps in the auto-refresh logic or edge cases where it might fail.</details></think>

---

The app **already has automatic token refresh** - users should stay connected indefinitely. Here's how it works:

## Current Auto-Refresh Flow

**Lines 87-117 in `useUserSpotifyApi.js`:**

1. Every API request checks if the access token is expired
2. If expired, it **automatically** calls `refreshUserToken()` (line 98)
3. Uses the stored refresh token to get a new access token
4. Updates Firestore with the new token
5. Retries the API request with the fresh token

**The refresh token never expires**, so users stay connected until they manually disconnect.

## Potential Issues

If users ARE experiencing disconnections after an hour, it could be:

1. **The refresh token isn't being stored** - Check line 66 in `useUserSpotifyApi.js`:
```javascript
refreshToken: result.refreshToken || userData.spotifyTokens.refreshToken
```

2. **Backend refresh endpoint might be failing** - Check `functions/src/spotify.js` lines 83-139

3. **The auto-refresh might not trigger on all code paths** - Some operations might bypass `makeUserRequest()`

Let me check what operations use Spotify authentication:

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "makeUserRequest|useUserSpotifyApi" • 42 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `.\src\views\music\AlbumView.vue` | `import \{ useUserSpotifyApi \} from '@composables/useUserSpotifyApi';` | L4 |
| `.\src\views\music\AlbumView.vue` | `const \{ getAlbum, getAlbumTracks, getPlaylistAlbumsWithDates\} = useUserSpotifyApi();` | L27 |
| `.\src\views\music\ArtistView.vue` | `import \{ useUserSpotifyApi \} from '@composables/useUserSpotifyApi';` | L10 |
| `.\src\views\music\ArtistView.vue` | `const \{ getArtist, getArtistAlbums\} = useUserSpotifyApi();` | L21 |
| `.\src\components\SpotifyDiagnostic.vue` | `import \{ useUserSpotifyApi \} from '@/composables/useUserSpotifyApi';` | L6 |
| `.\src\components\SpotifyDiagnostic.vue` | `const \{ getUserTokens, makeUserRequest \} = useUserSpotifyApi();` | L10 |
| `.\src\components\SpotifyDiagnostic.vue` | `await makeUserRequest('/me');` | L88 |
| `.\src\composables\useUserSpotifyApi.js` | `export function useUserSpotifyApi() \{` | L7 |
| `.\src\composables\useUserSpotifyApi.js` | `const makeUserRequest = async (endpoint, options = \{}) => \{` | L82 |
| `.\src\composables\useUserSpotifyApi.js` | `const profile = await makeUserRequest('https://api.spotify.com/v1/me');` | L135 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(`https://api.spotify.com/v1/users/$\{profile.id\}/playlists`, \{` | L148 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(`https://api.spotify.com/v1/playlists/$\{playlistId\}/tracks`, \{` | L158 |
| `.\src\composables\useUserSpotifyApi.js` | `const albumTracks = await makeUserRequest(`https://api.spotify.com/v1/albums/$\{albumId\}/tracks?limit=50`);` | L171 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(`https://api.spotify.com/v1/me/playlists?limit=$\{limit\}&offset=$\{offset\}`);` | L184 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(`https://api.spotify.com/v1/playlists/$\{playlistId\}`);` | L191 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(`https://api.spotify.com/v1/playlists/$\{playlistId\}`, \{` | L198 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(`https://api.spotify.com/v1/playlists/$\{playlistId\}/tracks?limit=$\{limit\}&offset=$\{offset\}`);` | L208 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(`https://api.spotify.com/v1/playlists/$\{playlistId\}/tracks`, \{` | L305 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(`https://api.spotify.com/v1/search?q=$\{encodedQuery\}&type=album&limit=$\{limit\}`);` | L316 |
| `.\src\composables\useUserSpotifyApi.js` | `const data = await makeUserRequest(` | L338 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(` | L367 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(`https://api.spotify.com/v1/albums/$\{albumId\}`);` | L394 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(` | L401 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(` | L410 |
| `.\src\composables\useUserSpotifyApi.js` | `return makeUserRequest(`https://api.spotify.com/v1/artists/$\{artistId\}`);` | L419 |
| `.\src\composables\useUserSpotifyApi.js` | `makeUserRequest,` | L425 |
| `.\src\views\playlists\PlaylistView.vue` | `import \{ useUserSpotifyApi \} from '@composables/useUserSpotifyApi';` | L9 |
| `.\src\views\playlists\PlaylistView.vue` | `const \{ getPlaylist\} = useUserSpotifyApi();` | L18 |
| `.\src\views\playlists\PlaylistSingle.vue` | `import \{ useUserSpotifyApi \} from '@composables/useUserSpotifyApi';` | L18 |
| `.\src\views\playlists\PlaylistSingle.vue` | `const \{ getPlaylist, getPlaylistAlbumsWithDates, loadAlbumsBatched, addAlbumToPlaylist, removeAlbumFromPlaylist: removeFromSpotify, loading: spotifyLoading, error: spotifyError \} = useUserSpotifyApi();` | L22 |
| `.\src\utils\lastFmUtils.js` | `import \{ useUserSpotifyApi \} from '@composables/useUserSpotifyApi';` | L2 |
| `.\src\utils\lastFmUtils.js` | `const \{ getAlbumTracks \} = useUserSpotifyApi();` | L84 |
| `.\src\composables\useAlbumsData.js` | `import \{ useUserSpotifyApi \} from '@/composables/useUserSpotifyApi';` | L7 |
| `.\src\composables\useAlbumsData.js` | `const \{ getPlaylistAlbumsWithDates \} = useUserSpotifyApi();` | L350 |
| `.\src\components\AlbumItem.vue` | `import \{ useUserSpotifyApi \} from '@composables/useUserSpotifyApi';` | L7 |
| `.\tasks\security-remediation-spec.md` | `│   ├── useUserSpotifyApi.js     # MODIFY: Use backend endpoints` | L98 |
| `.\src\views\playlists\PlaylistManagementView.vue` | `import \{ useUserSpotifyApi \} from '@composables/useUserSpotifyApi';` | L282 |
| `.\src\views\playlists\PlaylistManagementView.vue` | `\} = useUserSpotifyApi();` | L300 |
| `.\src\views\playlists\AddPlaylistView.vue` | `import \{ useUserSpotifyApi \} from '@composables/useUserSpotifyApi';` | L285 |
| `.\src\views\playlists\AddPlaylistView.vue` | `const \{ getUserPlaylists, isAudioFoodiePlaylist \} = useUserSpotifyApi();` | L292 |
| `.\src\components\AlbumSearch.vue` | `import \{ useUserSpotifyApi \} from '@composables/useUserSpotifyApi';` | L86 |
| `.\src\components\AlbumSearch.vue` | `const \{ searchAlbums, loading: spotifyLoading \} = useUserSpotifyApi();` | L97 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Good - all the Spotify user operations go through `useUserSpotifyApi` and call `makeUserRequest`, which has the auto-refresh logic. So the auto-refresh should be working for all operations.

The user seems to think the app stops working after an hour, but based on the code, it should automatically refresh. Let me explain this clearly and also point out that they might want to verify it's actually working or check if there's an issue with the backend refresh endpoint.</details></think>

---

Good news - **all Spotify operations use `makeUserRequest()`**, which has the auto-refresh logic. The app should handle token expiration transparently.

## Here's what should happen:

1. User connects Spotify → gets access token (1hr) + refresh token (permanent)
2. After 1 hour, next API call detects expired token
3. App automatically uses refresh token to get new access token
4. User never notices - continues working seamlessly

## Why you might be experiencing issues:

Check if the **backend refresh endpoint** is working. The refresh logic calls your Firebase Function at `functions/src/spotify.js`. 

To verify this is working, check:

1. **Browser console logs** - Look for:
   - `"Using existing token, expires at:"` (line 91)
   - `"Attempting token refresh..."` (line 96)  
   - `"Token refreshed successfully"` (line 99)

2. **Firebase Functions logs** - Check if `refreshToken` function is being called and succeeding

3. **Check if refresh token is being stored** - In Firestore, verify `users/{uid}/spotifyTokens.refreshToken` exists

If you want, switch to agent mode and I can add better error logging or implement a proactive token refresh (refresh before expiration instead of waiting for it to fail).

---

_**User (2025-10-11 09:30Z)**_

move the spotify conn diagnostics aboe the last fm stats

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
The user wants to move the Spotify connection diagnostics above the Last.fm stats. I need to find where these components are being used together, likely in a view file.

Let me search for where both SpotifyDiagnostic and LastFmStats are used together.</details></think>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "SpotifyDiagnostic|LastFmStats" • 4 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `.\src\views\auth\AccountView.vue` | `import LastFmStats from '@components/LastFmStats.vue';` | L12 |
| `.\src\views\auth\AccountView.vue` | `import SpotifyDiagnostic from '@components/SpotifyDiagnostic.vue';` | L13 |
| `.\src\views\auth\AccountView.vue` | `<LastFmStats :username="userData.lastFmUserName" />` | L122 |
| `.\src\views\auth\AccountView.vue` | `<SpotifyDiagnostic />` | L127 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Perfect! I found them in `AccountView.vue`. The Last.fm Stats is on line 122 and SpotifyDiagnostic is on line 127. I need to swap their positions so SpotifyDiagnostic comes first.

Let me read the file to see the context and make the change properly.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/views/auth/AccountView.vue</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
I can see the structure. I need to swap the two sections:
- Lines 119-123: Last.fm Stats Section
- Lines 125-128: Spotify Diagnostic Section

I'll move the Spotify Diagnostic section above the Last.fm Stats section.</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: src/views/auth/AccountView.vue</summary>

**Chunk 1**
Lines added: 5, lines removed: undefined

```diff
@@ -116,4 +116,9 @@
        &lt;/div&gt;
      &lt;/div&gt;
+     
+     &lt;!-- Spotify Diagnostic Section --&gt;
+     &lt;div v-if="userData" class="mt-8"&gt;
+       &lt;SpotifyDiagnostic /&gt;
+     &lt;/div&gt;
      
      &lt;!-- Last.fm Stats Section --&gt;
```

**Chunk 2**
Lines added: undefined, lines removed: 5

```diff
@@ -122,9 +127,4 @@
        &lt;LastFmStats :username="userData.lastFmUserName" /&gt;
      &lt;/div&gt;
-     
-     &lt;!-- Spotify Diagnostic Section --&gt;
-     &lt;div v-if="userData" class="mt-8"&gt;
-       &lt;SpotifyDiagnostic /&gt;
-     &lt;/div&gt;
      
      &lt;!-- Cache Management Section --&gt;
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Done! The Spotify Diagnostic section is now above the Last.fm Stats section. Let me check if there are any linter errors.</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `src/views/auth/AccountView.vue`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Perfect! No linter errors. The change is complete. The Spotify Diagnostic section is now displayed above the Last.fm Stats section on the Account page.</details></think>

---

Done! I've moved the Spotify connection diagnostics above the Last.fm stats in the Account view. The Spotify Diagnostic section will now appear first, followed by the Last.fm Stats section.

---

