<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 64dbab73-1243-4d64-9c5b-af335610707d (2025-11-19 12:17Z) -->

# Data structure limitations for albums (2025-11-19 12:17Z)

_**User (2025-11-18 15:11Z)**_

just had a concern. guess the data structures don't lend themselves to an album belonging to multiple playlists at the same time?

---

_**Agent (model default, mode Ask)**_



---


Reviewing the data structures to see how albums and playlists are related.


---

Could not find file '.cursor/rules/data-structures.mdc' in the workspace.

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How are albums associated with playlists in the data structure?" • **9** results</summary>
            
| File | Lines |
|------|-------|
| `src/composables/useAlbumsData.js` | L24-664 |
| `src/composables/useAlbumsData.js` | L664 |
| `src/composables/useUserSpotifyApi.js` | L5-654 |
| `src/views/playlists/PlaylistSingle.vue` | L1582-1614 |
| `src/views/music/ArtistView.vue` | L47-103 |
| `src/components/AlbumItem.vue` | L37-129 |
| `tasks/pipeline-playlist-spec.md` | L60 |
| `src/views/playlists/PlaylistSingle.vue` | L1078-1125 |
| `src/views/playlists/PlaylistSingle.vue` | L2154-2197 |

</details>
</tool-use>

---



---


Examining the album data structure more closely:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useAlbumsData.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/composables/useAlbumsData.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "removedAt.*null|!.*removedAt" in "src" • 12 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `src\views\playlists\PlaylistSingle.vue` | `const currentEntry = userData.playlistHistory.find(entry => !entry.removedAt);` | L802 |
| `src\composables\useAlbumsData.js` | `const currentEntry = data.playlistHistory.find(entry => !entry.removedAt);` | L117 |
| `src\composables\useAlbumsData.js` | `removedAt: null` | L382 |
| `src\composables\useAlbumsData.js` | `? [...existingData.playlistHistory.filter(h => h.removedAt !== null), newEntry]` | L387 |
| `src\composables\useAlbumsData.js` | `const currentEntry = data.playlistHistory.find(entry => !entry.removedAt);` | L564 |
| `src\composables\useAlbumsData.js` | `// Find the current entry for this playlist (where removedAt is null)` | L602 |
| `src\composables\useAlbumsData.js` | `entry => entry.playlistId === playlistId && !entry.removedAt` | L604 |
| `src\views\music\ArtistView.vue` | `if (albumStatus?.playlistHistory?.find(h => !h.removedAt)) \{` | L79 |
| `src\views\music\ArtistView.vue` | `const currentEntry = userData.playlistHistory.find(entry => !entry.removedAt);` | L128 |
| `src\views\music\ArtistView.vue` | `const currentEntry = userData.playlistHistory.find(entry => !entry.removedAt);` | L172 |
| `src\views\music\ArtistView.vue` | `:currentPlaylist="albumsStatus[album.id]?.playlistHistory?.find(h => !h.removedAt)"` | L282 |
| `src\views\music\SearchView.vue` | `const currentEntry = userData.playlistHistory.find(entry => !entry.removedAt);` | L107 |


</details>
</tool-use>

---



---


Checking how albums are removed from playlists:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "removeAlbumFromCollection|removedAt.*=" in "src/composables/useAlbumsData.js" • 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `src/composables/useAlbumsData.js` | `? [...existingData.playlistHistory.filter(h => h.removedAt !== null), newEntry]` | L387 |


</details>
</tool-use>

---



---





---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How is an album removed from a playlist and how is removedAt set?" • **10** results</summary>
            
| File | Lines |
|------|-------|
| `src/composables/useAlbumsData.js` | L24-664 |
| `src/views/playlists/PlaylistSingle.vue` | L1122-1160 |
| `src/views/playlists/PlaylistSingle.vue` | L1156-1211 |
| `src/views/playlists/PlaylistManagementView.vue` | L372-421 |
| `src/composables/useUserSpotifyApi.js` | L5-654 |
| `src/components/AlbumItem.vue` | L175-224 |
| `src/components/AlbumItem.vue` | L127-179 |
| `src/views/playlists/PlaylistSingle.vue` | L1208-1256 |
| `src/views/playlists/PlaylistSingle.vue` | L2154-2197 |
| `src/components/AlbumItem.vue` | L37-129 |

</details>
</tool-use>

---



---


The data structure can support multiple active playlists, but the code assumes only one.

**The data structure:**
- `playlistHistory` is an array of entries, each with `playlistId` and `removedAt`
- Multiple entries can have `removedAt: null` (active)

**The implementation:**
1. When adding an album (line 387), it keeps existing active entries:
```386:388:src/composables/useAlbumsData.js
        playlistHistory: existingData?.playlistHistory 
          ? [...existingData.playlistHistory.filter(h => h.removedAt !== null), newEntry]
          : [newEntry],
```

2. When checking status, it only finds the first active entry:
```117:117:src/composables/useAlbumsData.js
    const currentEntry = data.playlistHistory.find(entry => !entry.removedAt);
```

3. Removal targets a specific playlist, so other active entries remain.

**The problem:**
- The structure allows multiple active playlists
- The code uses `.find()` instead of `.filter()`, so only one is shown
- There’s no validation preventing duplicates
- The UI assumes a single active playlist

**To properly support multiple playlists:**
- Change status checks from `.find()` to `.filter()` to get all active entries
- Update UI to display/handle multiple playlists
- Add validation to prevent duplicate active entries if that’s desired

Right now, if an album is added to multiple playlists, only the first will be detected/displayed.

---

